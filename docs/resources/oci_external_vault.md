---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "ciphertrust_oci_external_vault Resource - terraform-provider-ciphertrust"
subcategory: ""
description: |-
  
---

# ciphertrust_oci_external_vault (Resource)

This resource specifies an external vault in which external keys can be created.

OCI external vault resources can be created using either by using the tenancy details of a [ciphertrust_oci_connection](https://registry.terraform.io/providers/ThalesGroup/ciphertrust/latest/docs/resources/oci_connection) resource or with specified tenancy details.

Both alternatives are shown below.

[ciphertrust_oci_external_keys](https://registry.terraform.io/providers/ThalesGroup/ciphertrust/latest/docs/resources/oci_external_key) resources are dependent on this resource.

This resource is dependent on a [ciphertrust_oci_issuer](https://registry.terraform.io/providers/ThalesGroup/ciphertrust/latest/docs/resources/oci_issuer) resource.

## Example Usage

```terraform
# Create an OCI connection
resource "ciphertrust_oci_connection" "oci_connection" {
  key_file            = "oci-key-file"
  name                = "connection-name"
  pub_key_fingerprint = "public-key-fingerprint"
  region              = "oci-region"
  tenancy_ocid        = "tenancy-ocid"
  user_ocid           = "user-ocid"
}

# Create an OCI issuer resource
resource "ciphertrust_oci_issuer" "issuer" {
  name              = "issuer-name"
  openid_config_url = "open-config-url"
}

# Create an OCI external vault that will only accept CipherTrust keys
resource "ciphertrust_oci_external_vault" "vault_with_connection" {
  client_application_id = "oci-client-application-id"
  connection_id         = ciphertrust_oci_connection.oci_connection.id
  issuer_id             = ciphertrust_oci_issuer.issuer.id
  source_key_tier       = "local"
  vault_name            = "vault-name"
}

# Create a CipherTrust key that can be added to the vault
resource "ciphertrust_cm_key" "ciphertrust_key" {
  name         = "key-name"
  algorithm    = "AES"
  undeletable  = true
  unexportable = true
}

# Add the key to the vault
resource "ciphertrust_oci_external_key" "external_key" {
  cckm_vault_id = ciphertrust_oci_external_vault.vault_with_connection.id
  name          = "key-name"
  source_key_id = ciphertrust_cm_key.ciphertrust_key.id
}

# Create a tenancy resource
resource "ciphertrust_oci_tenancy" "tenancy" {
  tenancy_ocid = "tenancy-ocid"
  tenancy_name = "tenancy-name"
}

# Create an OCI external vault using a tenancy resource that will only accept Hsm-Luna keys
resource "ciphertrust_oci_external_vault" "vault_with_tenancy" {
  client_application_id = "oci-client-application-id"
  issuer_id             = ciphertrust_oci_issuer.issuer.id
  source_key_tier       = "hsm-luna"
  tenancy_id            = ciphertrust_oci_tenancy.tenancy.id
  vault_name            = "vault-name"
}

# Create a ciphertrust_hsm_server resource
resource "ciphertrust_hsm_server" "hsm_server" {
  hostname        = "hsm-ip"
  hsm_certificate = "hsm-server.pem"
}

# Create a ciphertrust_hsm_connection resource
resource "ciphertrust_hsm_connection" "hsm_connection" {
  is_ha_enabled = true
  hostname    = "hsm-ip"
  server_id   = ciphertrust_hsm_server.hsm_server.id
  name        = "connection-name"
  partitions {
    partition_label = "partition-label"
    serial_number   = "serial-number"
  }
  partition_password = "partition-password"
}

# Create a ciphertrust_hsm_partition resource
resource "ciphertrust_hsm_partition" "hsm_partition" {
  hsm_connection = ciphertrust_hsm_connection.hsm_connection.id
}

# Create a Hsm-Luna AES key that is can be added the external vault
resource "ciphertrust_hsm_key" "hsm_luna_key" {
  hyok_key     = true
  key_size     = 256
  label        = "key-name"
  mechanism    = "CKM_AES_KEY_GEN"
  partition_id = ciphertrust_hsm_partition.hsm_partition.id
}

# Add the key to the vault
resource "ciphertrust_oci_external_key" "external_key" {
  cckm_vault_id   = ciphertrust_oci_external_vault.vault_with_tenancy.id
  name            = "key-name"
  source_key_id   = ciphertrust_hsm_key.hsm_luna_key.id
  source_key_tier = "hsm-luna"
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `client_application_id` (String) Client ID of the OCI KMS application as registered on third-party IDP.
- `issuer_id` (String) (Updateable) Terraform resource ID of the issuer.
- `vault_name` (String) Vault name.

### Optional

- `blocked` (Boolean) (Updateable) If true, all proxy operations on keys belonging to the vault are blocked. Default is false.
- `connection_id` (String) (Updateable) CipherTrust OCI connection ID. Specify either one of the tenancy inputs (tenancy_ocid, tenancy_name, tenancy_id) or connection_id.
- `endpoint_url_hostname` (String) (Updateable) Hostname for the OCI external vault endpoint URL. Default value is localhost. Default is localhost
- `endpoint_url_port` (Number) (Updateable) Port-Number for the OCI external vault endpoint URL. Default is 433
- `partition_id` (String) Hsm-luna partition ID. Required if 'hsm-luna' is provided as source_key_tier.
- `policy` (String) OCI policy for the vault.
- `policy_file` (String) Path to a file containing the OCI policy.
- `source_key_tier` (String) Define source key tier for the vault. Only 'local' and 'hsm-luna' source key-tiers are supported for vaults. If provided the vault is locked to support keys only of the specified source key-tier. If not supplied keys can be created using any of the allowed source key-tiers.
- `tenancy_id` (String) Tenancy resource ID. Specify either one of the tenancy inputs (tenancy_ocid, tenancy_name, tenancy_id) or connection_id
- `tenancy_name` (String) Tenancy Name. Specify either one of the tenancy inputs (tenancy_ocid, tenancy_name, tenancy_id) or connection_id
- `tenancy_ocid` (String) Tenancy OCID. Specify either one of the tenancy inputs (tenancy_ocid, tenancy_name, tenancy_id) or connection_id

### Read-Only

- `acls` (List of Object) List of ACLs that have been added to the vault. (see [below for nested schema](#nestedatt--acls))
- `cloud_name` (String) Cloud name.
- `created_at` (String) Date and time the vault was created.
- `endpoint_url` (String) External vault endpoint URL.
- `external_vault_type` (String) External vault type.
- `id` (String) CipherTrust vault ID.
- `linked_state` (Boolean) Linked state of the vault.
- `meta` (Map of String) Vault metadata.
- `region` (String) OCI region.
- `state` (String) Vault state.
- `updated_at` (String) Date and time of last update.
- `vault_type` (String) Vault type.

<a id="nestedatt--acls"></a>
### Nested Schema for `acls`

Read-Only:

- `actions` (Set of String)
- `group` (String)
- `user_id` (String)
