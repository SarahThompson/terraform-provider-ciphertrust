---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "ciphertrust_oci_external_key Resource - terraform-provider-ciphertrust"
subcategory: ""
description: |-
  
---

# ciphertrust_oci_external_key (Resource)

This resource creates a key in a [ciphertrust_oci_external_vault](https://registry.terraform.io/providers/ThalesGroup/ciphertrust/latest/docs/resources/oci_external_vault)

External keys may be created from the following key sources:
- CipherTrust Manager Key [ciphertrust_cm_key](https://registry.terraform.io/providers/ThalesGroup/ciphertrust/latest/docs/resources/cm_key)
- Luna-HSM Key [ciphertrust_hsm_key](https://registry.terraform.io/providers/ThalesGroup/ciphertrust/latest/docs/resources/hsm_key)

External keys can only be symmetric AES keys. 

Keys can be blocked, unblocked or scheduled for rotation using this resource. 

Container resources for scheduled rotation are:
- Luna-HSM Partition [ciphertrust_hsm_partition](https://registry.terraform.io/providers/ThalesGroup/ciphertrust/latest/docs/resources/hsm_partition)

Scheduling key rotation requires a [ciphertrust_scheduler](https://registry.terraform.io/providers/ThalesGroup/ciphertrust/latest/docs/resources/scheduler) resource.

This resource is dependent on a [ciphertrust_oci_external_vault](https://registry.terraform.io/providers/ThalesGroup/ciphertrust/latest/docs/resources/oci_external_vault) resource.

New versions of the key can be created using the [ciphertrust_oci_external_key_version](https://registry.terraform.io/providers/ThalesGroup/ciphertrust/latest/docs/resources/oci_external_key_version) resource.

Creating a key also creates the first version of the key. This version, if required, can be imported into the terraform state. Refer to the [ciphertrust_oci_external_key_version](https://registry.terraform.io/providers/ThalesGroup/ciphertrust/latest/docs/resources/oci_external_key_version) resource documentation for information on how to do that.

## Example Usage

```terraform
# Create a tenancy
resource "ciphertrust_oci_tenancy" "oci_tenancy" {
  tenancy_ocid = "tenancy-ocid"
  tenancy_name = "tenancy-name"
}

# Create an OCI issuer
resource "ciphertrust_oci_issuer" "oci_issuer" {
  name              = "issuer-name"
  openid_config_url = "open-config-url"
}

# Create an OCI external vault that will accept both CipherTrust and Hsm-Luna keys
resource "ciphertrust_oci_external_vault" "external_vault" {
  client_application_id = "oci-client-application-id"
  issuer_id             = ciphertrust_oci_issuer.oci_issuer.id
  tenancy_id            = ciphertrust_oci_tenancy.oci_tenancy.id
  vault_name            = "vault-name"
}

# Create a CipherTrust key that can be added to the vault
resource "ciphertrust_cm_key" "ciphertrust_key" {
  name         = "key-name"
  algorithm    = "AES"
  undeletable  = true
  unexportable = true
}

# Add the key to the vault
resource "ciphertrust_oci_external_key" "external_key" {
  cckm_vault_id = ciphertrust_oci_external_vault.external_vault.id
  name          = "key-name"
  source_key_id = ciphertrust_cm_key.ciphertrust_key.id
}

# Create a ciphertrust_hsm_server resource
resource "ciphertrust_hsm_server" "hsm_server" {
  hostname        = "hsm-ip"
  hsm_certificate = "hsm-server.pem"
}

# Create a ciphertrust_hsm_connection resource
resource "ciphertrust_hsm_connection" "hsm_connection" {
  is_ha_enabled = true
  hostname    = "hsm-ip"
  server_id   = ciphertrust_hsm_server.hsm_server.id
  name        = "connection-name"
  partitions {
    partition_label = "partition-label"
    serial_number   = "serial-number"
  }
  partition_password = "partition-password"
}

# Create a ciphertrust_hsm_partition resource
resource "ciphertrust_hsm_partition" "hsm_partition" {
  hsm_connection = ciphertrust_hsm_connection.hsm_connection.id
}

# Create a Hsm-Luna AES key that is able to be added to the vault
resource "ciphertrust_hsm_key" "hsm_luna_key" {
  hyok_key     = true
  key_size     = 256
  label        = "key-name"
  mechanism    = "CKM_AES_KEY_GEN"
  partition_id = ciphertrust_hsm_partition.hsm_partition.id
  tenancy_id   = ciphertrust_oci_tenancy.oci_tenancy.id
}

# Add the key to the vault
resource "ciphertrust_oci_external_key" "external_key" {
  cckm_vault_id   = ciphertrust_oci_external_vault.external_vault.id
  name            = "key-name"
  source_key_id   = ciphertrust_hsm_key.hsm_luna_key.id
  source_key_tier = "hsm-luna"
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `cckm_vault_id` (String) CipherTrust Manager vault ID
- `name` (String) (Updateable) Unique name for the key.
- `source_key_id` (String) Source key ID. If not provided a key will be created.

### Optional

- `blocked` (Boolean) (Updateable) If true, access to encrypt, decrypt and generate-random-bytes APIs is blocked. Default is false.
- `enable_rotation` (Block List, Max: 1) (Updateable) Enable the key for scheduled rotation job. Note: Key rotation can cause drift. (see [below for nested schema](#nestedblock--enable_rotation))
- `policy` (String) (Updateable) OCI policy string.
- `policy_file` (String) (Updateable) Path to a file containing the OCI policy.
- `source_key_tier` (String) Source of the key. Options: local, hsm-luna. Default is local.

### Read-Only

- `algorithm` (String) Algorithm of the key.
- `cckm_vault_name` (String) CipherTrust Manager vault name.
- `cloud_name` (String) CipherTrust cloud name.
- `created_at` (String) Date and time the key was created.
- `id` (String) CipherTrust key ID.
- `key_length` (Number) Length of key in bytes.
- `key_material_origin` (String) Key material origin.
- `labels` (Map of String) Map of labels associated with the key.
- `linked_state` (Boolean) Linked state of the key.
- `state` (String) State of the key.
- `tenancy` (String) Tenancy
- `updated_at` (String) Date and time of last update.
- `versions` (List of Object) Key version details. (see [below for nested schema](#nestedatt--versions))

<a id="nestedblock--enable_rotation"></a>
### Nested Schema for `enable_rotation`

Required:

- `job_config_id` (String) (Updateable) ID of the scheduler job that will perform key rotation.

Optional:

- `hsm_partition_id` (String) (Updateable) ID of the partition in which HSM keys will be created.
- `key_source` (String) (Updateable) Source of the key material. Options: ciphertrust, hsm-luna. Default is ciphertrust


<a id="nestedatt--versions"></a>
### Nested Schema for `versions`

Read-Only:

- `cckm_version_id` (String)
- `created_at` (String)
- `source_key_id` (String)
- `source_key_name` (String)
- `source_key_tier` (String)
