---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "ciphertrust_aws_xks_key Resource - terraform-provider-ciphertrust"
subcategory: ""
description: |-
  Use this resource to create an AWS XKS key.
---

# ciphertrust_aws_xks_key (Resource)

Use this resource to create an AWS XKS key.

## Example Usage

```terraform
# Create an AWS connection
resource "ciphertrust_aws_connection" "aws-connection" {
  name              = "aws_connection_name"
  access_key_id     = "access-key-id"
  secret_access_key = "secret-access-key"
}
output "aws_connection_id" {
  value = ciphertrust_aws_connection.aws-connection.id
}

# Get the AWS account details
data "ciphertrust_aws_account_details" "account_details" {
  aws_connection = ciphertrust_aws_connection.aws-connection.id
}

# Create a kms
resource "ciphertrust_aws_kms" "kms" {
  depends_on = [
    ciphertrust_aws_connection.aws-connection,
  ]
  account_id     = data.ciphertrust_aws_account_details.account_details.account_id
  aws_connection = ciphertrust_aws_connection.aws-connection.id
  name           = "kms-name"
  regions        = data.ciphertrust_aws_account_details.account_details.regions
}

# Create an AES CipherTrust key for creating EXTERNAL_KEY_STORE with CM as key source
# key should be unexportable, undeletable, symmetric AES 256 key
resource "ciphertrust_cm_key" "cm_aes_key" {
  name         = "aes-key-name"
  algorithm    = "AES"
  usage_mask   = 60
  unexportable = true
  undeletable  = true
}

# Create a policy template using key users and roles
resource "ciphertrust_aws_policy_template" "template_with_users_and_roles" {
  name             = "template-with-users-and-roles-test"
  kms              = ciphertrust_aws_kms.kms.id
  key_admins       = ["key-admins"]
  key_admins_roles = ["key-admins-roles"]
  key_users        = ["key-users"]
  key_users_roles  = ["key-users-roles"]
}

# Create unlinked external custom keystore with CM as key source; with xks proxy connectivity as PUBLIC_ENDPOINT
resource "ciphertrust_aws_custom_keystore" "unlinked_xks_custom_keystore_for_cm_as_source" {
  depends_on = [
    ciphertrust_aws_kms.kms,
    ciphertrust_cm_key.cm_aes_key,
  ]
  name                        = "unlinked-xks-demo-1-for-cm-as-source"
  region                      = "us-west-1"
  kms                         = ciphertrust_aws_kms.kms.name
  linked_state                = false
  connect_disconnect_keystore = "DISCONNECT_KEYSTORE"
  local_hosted_params {
    blocked             = false
    health_check_key_id = ciphertrust_cm_key.cm_aes_key.id
    max_credentials     = 8
    source_key_tier     = "local"
  }
  aws_param {
    xks_proxy_uri_endpoint = "https://demo-xksproxy.thalescpl.io"
    xks_proxy_connectivity = "PUBLIC_ENDPOINT"
    custom_key_store_type  = "EXTERNAL_KEY_STORE"
  }
}

# Set blocked = true to block above unlinked keystore

# Create an unlinked XKS key with cm as key source in above unlinked external key store
resource "ciphertrust_aws_xks_key" "xks_unlinked_key_with_cm_as_source_1" {
  depends_on = [
    ciphertrust_aws_custom_keystore.unlinked_xks_custom_keystore_for_cm_as_source,
    ciphertrust_cm_key.cm_aes_key,
    ciphertrust_aws_policy_template.template_with_users_and_roles,
  ]

  local_hosted_params {
    blocked             = false
    custom_key_store_id = ciphertrust_aws_custom_keystore.unlinked_xks_custom_keystore_for_cm_as_source.id
    linked              = false
    source_key_id       = ciphertrust_cm_key.cm_aes_key.id
    source_key_tier     = "local"
  }
  description = "desc for xks_unlinked_key_with_cm_as_source_1"
  alias       = ["a1_cm_unlinked_key_1"]
  tags = {
    Tagkey1 = "TagValue1"
    Tagkey2 = "TagValue2"
  }
  key_policy {
    policy_template = ciphertrust_aws_policy_template.template_with_users_and_roles.id
  }
}

# Create linked external custom keystore with CM as key source; with xks proxy connectivity as PUBLIC_ENDPOINT
resource "ciphertrust_aws_custom_keystore" "linked_xks_custom_keystore_for_cm_as_source" {
  depends_on = [
    ciphertrust_aws_kms.kms,
    ciphertrust_cm_key.cm_aes_key,
  ]
  name                        = "linked-xks-demo-1-for-cm-as-source"
  region                      = ciphertrust_aws_kms.kms.regions[0]
  kms                         = ciphertrust_aws_kms.kms.name
  linked_state                = true
  connect_disconnect_keystore = "DISCONNECT_KEYSTORE"
  local_hosted_params {
    blocked             = false
    health_check_key_id = ciphertrust_cm_key.cm_aes_key.id
    max_credentials     = 8
    source_key_tier     = "local"
  }
  aws_param {
    xks_proxy_uri_endpoint = "https://demo-xksproxy.thalescpl.io"
    xks_proxy_connectivity = "PUBLIC_ENDPOINT"
    custom_key_store_type  = "EXTERNAL_KEY_STORE"
  }
}

# Set connect_disconnect_keystore = CONNECT_KEYSTORE to connect above linked keystore
# Set blocked = true to block above linked keystore

# Create an linked XKS key with cm as key source in above linked external key store
resource "ciphertrust_aws_xks_key" "xks_linked_key_with_cm_as_source_1" {
  depends_on = [
    ciphertrust_aws_custom_keystore.linked_xks_custom_keystore_for_cm_as_source,
    ciphertrust_cm_key.cm_aes_key,
    ciphertrust_aws_policy_template.template_with_users_and_roles,
  ]

  local_hosted_params {
    blocked             = false
    custom_key_store_id = ciphertrust_aws_custom_keystore.linked_xks_custom_keystore_for_cm_as_source.id
    linked              = true
    source_key_id       = ciphertrust_cm_key.cm_aes_key.id
    source_key_tier     = "local"
  }
  description = "desc for xks_linked_key_with_cm_as_source_1"
  alias       = ["a1_cm_linked_key_1"]
  tags = {
    Tagkey1 = "TagValue1"
    Tagkey2 = "TagValue2"
  }
  key_policy {
    policy_template = ciphertrust_aws_policy_template.template_with_users_and_roles.id
  }
}

# Set linked = true to create linked keystore/xks key
```

<!-- schema generated by tfplugindocs -->
## Schema

### Optional

- `alias` (Set of String) Input parameter. Alias assigned to the XKS key.
- `bypass_policy_lockout_safety_check` (Boolean) Whether to bypass the key policy lockout safety check.
- `description` (String) Description of the AWS key. Descriptions can be updated but not removed.
- `enable_key` (Boolean) Enable or disable the key. Default is true.
- `enable_rotation` (Block List) Enable the key for scheduled rotation job. Parameters 'disable_encrypt' and 'disable_encrypt_on_all_accounts' are mutually exclusive (see [below for nested schema](#nestedblock--enable_rotation))
- `key_policy` (Block List) Key policy parameters. (see [below for nested schema](#nestedblock--key_policy))
- `local_hosted_params` (Block List) Parameters for a AWS XKS key. (see [below for nested schema](#nestedblock--local_hosted_params))
- `origin` (String) Source of the key material for the customer managed key.  Options: AWS_KMS, EXTERNAL, EXTERNAL_KEY_STORE, AWS_CLOUDHSM. AWS_KMS will create a native AWS key and is the default for AWS native key creation. EXTERNAL will create an external AWS key and is the default for import operations. This parameter is not required for upload operations. Origin is EXTERNAL_KEY_STORE for XKS/HYOK key and AWS_CLOUDHSM for key in CloudHSM key store.
- `schedule_for_deletion_days` (Number) Waiting period after the key is destroyed before the key is deleted. Only relevant when the resource is destroyed. Default is 7.
- `tags` (Map of String) A list of tags assigned to the XKS key.

### Read-Only

- `arn` (String) The Amazon Resource Name (ARN) of the key.
- `aws_account_id` (String) AWS account ID.
- `aws_custom_key_store_id` (String) Custom keystore ID in AWS.
- `aws_key_id` (String) AWS key ID.
- `aws_xks_key_id` (String) XKS key ID in AWS.
- `blocked` (Boolean) Parameter to indicate if AWS XKS key is blocked for any data plane operation.
- `cloud_name` (String) AWS cloud.
- `created_at` (String) Date the key was created.
- `custom_key_store_id` (String) Custom keystore ID in AWS.
- `customer_master_key_spec` (String) Whether the KMS key contains a symmetric key or an asymmetric key pair. Valid values: SYMMETRIC_DEFAULT, RSA_2048, RSA_3072, RSA_4096, ECC_NIST_P256, ECC_NIST_P384, ECC_NIST_P521, ECC_SECG_P256K1, HMAC_224, HMAC_256, HMAC_384, HMAC_512
- `deletion_date` (String) Date the key is scheduled for deletion.
- `enabled` (Boolean) True if the key is enabled.
- `encryption_algorithms` (List of String) Encryption algorithms of an asymmetric key
- `expiration_model` (String) Expiration model.
- `external_accounts` (Set of String) Other AWS accounts that have access to this key.
- `id` (String) XKS key ID.
- `key_admins` (Set of String) Key administrators - users.
- `key_admins_roles` (Set of String) Key administrators - roles.
- `key_id` (String) CipherTrust Manager Key ID.
- `key_manager` (String) Key manager.
- `key_material_origin` (String) Key material origin.
- `key_rotation_enabled` (Boolean) True if rotation is enabled in AWS for this key.
- `key_source` (String) Source of the key.
- `key_source_container_id` (String) ID of the source container of the key.
- `key_source_container_name` (String) Name of the source container of the key.
- `key_state` (String) Key state.
- `key_type` (String) Key type.
- `key_usage` (String) Specifies the intended use of the key. RSA key options: ENCRYPT_DECRYPT, SIGN_VERIFY. Default is ENCRYPT_DECRYPT. EC key options: SIGN_VERIFY. Default is SIGN_VERIFY. Symmetric key options: ENCRYPT_DECRYPT. Default is ENCRYPT_DECRYPT.
- `key_users` (Set of String) Key users - users.
- `key_users_roles` (Set of String) Key users - roles.
- `kms` (String) Name or of the KMS.
- `kms_id` (String) ID of the KMS
- `labels` (Map of String) A list of key:value pairs associated with the key.
- `linked` (Boolean) Parameter to indicate if AWS XKS key is linked with AWS.
- `local_key_id` (String) CipherTrust Manager key identifier of the external key.
- `local_key_name` (String) CipherTrust Manager key name of the external key.
- `policy` (String) AWS key policy.
- `policy_template_tag` (Map of String) AWS key tag for an associated policy template.
- `region` (String) AWS region in which the XKS key resides.
- `rotated_at` (String) Time when this key was rotated by a scheduled rotation job.
- `rotated_from` (String) CipherTrust Manager key ID from of the key this key has been rotated from by a scheduled rotation job.
- `rotated_to` (String) CipherTrust Manager key ID which this key has been rotated too by a scheduled rotation job.
- `rotation_status` (String) Rotation status of the key.
- `synced_at` (String) Date the key was synchronized.
- `updated_at` (String) Date the key was last updated.
- `valid_to` (String) Date of key material expiry.

<a id="nestedblock--enable_rotation"></a>
### Nested Schema for `enable_rotation`

Required:

- `job_config_id` (String) ID of the scheduler configuration job that will schedule the key rotation.
- `key_source` (String) Key source from where the key will be uploaded. Currently, the only option is 'local'.

Optional:

- `disable_encrypt` (Boolean) Disable encryption on the old key.
- `disable_encrypt_on_all_accounts` (Boolean) Disable encryption permissions on the old key for all the accounts


<a id="nestedblock--key_policy"></a>
### Nested Schema for `key_policy`

Optional:

- `external_accounts` (Set of String) Other AWS accounts that can access to the key.
- `key_admins` (Set of String) Key administrators - users.
- `key_admins_roles` (Set of String) Key administrators - roles.
- `key_users` (Set of String) Key users - users.
- `key_users_roles` (Set of String) Key users - roles.
- `policy` (String) AWS key policy json.
- `policy_template` (String) CipherTrust Manager policy template ID


<a id="nestedblock--local_hosted_params"></a>
### Nested Schema for `local_hosted_params`

Required:

- `blocked` (Boolean) Parameter to indicate if AWS XKS key is blocked for any data plane operation.
- `custom_key_store_id` (String) ID of the custom keystore where XKS key is to be created.
- `linked` (Boolean) Parameter to indicate if AWS XKS key is linked with AWS.
- `source_key_id` (String) ID of the source key for AWS XKS key.
- `source_key_tier` (String) Source key tier for AWS XKS key. Current option is local. Default is local.
